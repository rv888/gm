    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
     <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <style>
        .image-column {
            width: 20%;
            max-width: 20%;
        }
        .image-column img {
            width: 100%;
            height: auto;
        }
    </style>

    <!--                     <td class="image-column"><img src="image_url.jpg" class="img-fluid" alt="Responsive image"></td>
-->


<div class="container mt-4">
        <table class="table table-responsive" id="winners">
            <thead>
                <tr>
                    <th class="image-column"></th>
                    <th>Name</th>
                    <th>Won</th>
                </tr>
            </thead>
            <tbody id="winners_body">
            </tbody>
        </table>
    </div>

<script src="https://unpkg.com/nostr-tools/lib/nostr.bundle.js"></script>
<script>


var pk = "7dd040804955e939e63c9dd6b60aedf6c29b6ce7d3dcc91f37f06c3836f6813d";

const relay = window.NostrTools.relayInit('wss://purplepag.es');


/*

relay.on('connect', () => {
  console.log(`connected to ${relay.url}`)
})
relay.on('error', () => {
  console.log(`failed to connect to ${relay.url}`)
})

 relay.connect()

let sub = relay.sub([
  {
    kinds: [0],
    authors: [pk],
  },
])
*/


let relays = ['wss://purplepag.es', 'wss://relay.damus.io'];

const pool = new window.NostrTools.SimplePool();

function get_user_details(pk,won){


    let sub = pool.sub(
    [...relays],
    [
      {
        kinds: [0],
        authors: [pk],
      },
    ],
  )



  sub.on('event', event => {
    console.log('got event:', event)
    var nostrJson = JSON.parse(event.content);

    console.log(nostrJson);

    create_div(nostrJson, won);
    

  })



  sub.on('eose', () => {
    sub.unsub()
  })

}

function create_div(person,won){

  console.log(person);

  var table = document.getElementById('winners_body');

  var row = document.createElement('tr');

  var cell1 = document.createElement('td'), img = document.createElement('img');
  img.src = person.picture;
  img.alt = person.display_name; 
  img.classList.add('img-fluid');
  cell1.classList.add('image-column');

  cell1.appendChild(img);

  var cell2 = document.createElement('td');
  var cell3 = document.createElement('td');

  cell2.innerHTML = person.display_name;
  cell3.innerHTML = won.toString();

  row.appendChild(cell1);
  row.appendChild(cell2);
  row.appendChild(cell3);

  table.appendChild(row);

}




  //let pk1 = window.NostrTools.getPublicKey(sk1)

var now = new Date();
var midnight = new Date(now.getFullYear(), now.getMonth(), now.getDate());
var epochTime = midnight.getTime();
var epochSeconds = Math.floor(epochTime / 1000);

console.log(epochSeconds)

var filename = "7_days_"+epochSeconds.toString()+ ".json"

var url = "https://vsm.sfo3.cdn.digitaloceanspaces.com/wm/"+filename;

console.log(url);


fetch(url)  // Replace with your JSON URL
    .then(response => response.json()) // Convert the response to JSON
    .then(data => {
        // Loop through the key-value pairs
        Object.entries(data).forEach(([key, value]) => {
            console.log(`Key: ${key}, Value: ${value}`);
            get_user_details(key, value);
            
        });
    })
    .catch(error => {
        console.error('Error fetching JSON:', error);
    });




</script>

<!-- <img src="" id="picture1"> -->

